<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>æ ‘æ´ - ç§äººæƒ…ç»ªç©ºé—´</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
@import url('https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;500&display=swap');

html, body {
    height: 100%;
    margin: 0;
    font-family: 'Noto Serif SC', serif;
    overflow: hidden;
}

.bg-main {
    background-image: url('IMG_3004.jpg');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    height: 100vh;
    width: 100vw;
    display: flex;
    align-items: center;
    justify-content: center;
    position: relative;
}

.fade-in { animation: fadeIn 0.6s ease-in; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.btn-pink {
    background-color: #E68BA0;
    color: white;
    transition: transform .2s, background-color .2s;
}
.btn-pink:hover {
    background-color: #d67b90;
    transform: scale(1.02);
}

.beige-modal {
    background-color: #FDFBF5;
    border: 1px solid #D1C7B7;
    border-radius: 8px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.1);
    width: 90%;
    max-width: 500px;
    padding: 2.5rem;
}

.hide-scrollbar::-webkit-scrollbar { display: none; }

/* ğŸµ å£°éŸ³æŒ‰é’® */
.sound-toggle {
    position: absolute;
    top: 18px;
    right: 18px;
    font-size: 22px;
    cursor: pointer;
    opacity: .75;
    transition: opacity .2s, transform .2s;
    user-select: none;
}
.sound-toggle:hover {
    opacity: 1;
    transform: scale(1.1);
}
</style>
</head>

<body class="bg-stone-100">

<!-- ğŸµ èƒŒæ™¯éŸ³ä¹ï¼ˆå®Œå…¨ç‹¬ç«‹æ¨¡å—ï¼‰ -->
<audio
    id="bgm"
    src="bgm.mp3"
    autoplay
    muted
    loop
    playsinline
></audio>

<div class="bg-main">

    <!-- ğŸµ å£°éŸ³å¼€å…³ -->
    <div id="soundToggle" class="sound-toggle">ğŸ”‡</div>

    <!-- é¦–é¡µ -->
    <div id="page-home" class="flex flex-col items-center gap-6 fade-in">
        <button onclick="showPage('input')" class="btn-pink px-10 py-4 rounded-lg text-xl font-medium tracking-widest shadow-lg">
            ï¼‹ ä»Šæ—¥è®°å½•
        </button>
        <button onclick="showHistory()" class="text-white text-lg underline underline-offset-8 decoration-white/50 hover:text-white/80">
            é˜…è§ˆå¾€æ˜”
        </button>
    </div>

    <!-- è¾“å…¥é¡µ -->
    <div id="page-input" class="hidden beige-modal fade-in">
        <p class="text-xl text-stone-700 mb-6 text-center font-medium">
            ä»Šå¤©æœ‰ä»€ä¹ˆæƒ³ç•™ä¸‹çš„å—ï¼Ÿ
        </p>
        <textarea id="record-text"
            class="w-full h-40 bg-white/50 border border-stone-200 rounded p-4 focus:ring-1 focus:ring-stone-300 focus:outline-none resize-none mb-6"
            placeholder="åœ¨è¿™é‡Œå†™ä¸‹..."
            autofocus></textarea>

        <div class="flex flex-col items-center gap-4">
            <div class="flex gap-4 w-full">
                <button onclick="showPage('home')" class="flex-1 py-3 text-stone-400 hover:text-stone-600">å–æ¶ˆ</button>
                <button onclick="handleRecord()" class="flex-1 py-3 bg-stone-100 border border-stone-200 rounded-lg hover:bg-stone-200 font-medium">
                    å­˜å…¥
                </button>
            </div>
            <label class="flex items-center gap-2 text-stone-400 cursor-pointer text-xs mt-2">
                <input type="checkbox" id="only-record"> åªè®°å½•ï¼Œä¸éœ€è¦å›åº”
            </label>
        </div>
    </div>

    <!-- åé¦ˆé¡µ -->
    <div id="page-feedback" class="hidden beige-modal fade-in text-center">
        <div id="animal-container" class="mb-6 flex justify-center text-5xl"></div>
        <div id="ai-response" class="text-lg leading-loose text-stone-600 italic px-2"></div>
        <button onclick="showPage('home')" class="mt-8 text-stone-400 hover:text-stone-600 underline text-sm">
            å›åˆ°é¦–é¡µ
        </button>
    </div>

    <!-- å†å²é¡µ -->
    <div id="page-history" class="hidden beige-modal fade-in max-h-[80vh] flex flex-col">
        <h2 class="text-center text-stone-500 mb-6 tracking-widest font-medium">â€” å¾€æ˜”è®°å½• â€”</h2>
        <div id="history-list" class="overflow-y-auto flex-1 pr-2 space-y-8 hide-scrollbar"></div>
        <button onclick="showPage('home')" class="mt-6 text-stone-400 hover:text-stone-600 text-sm">å…³é—­</button>
    </div>

</div>

<script>
/* ================= ğŸµ BGMï¼ˆå®Œå…¨ä¸ç¢°åŸé€»è¾‘ï¼‰ ================= */
const bgm = document.getElementById('bgm');
const soundToggle = document.getElementById('soundToggle');
let muted = true;

window.addEventListener('load', () => {
    bgm.volume = 0.5;
    bgm.play().catch(()=>{});
});

document.addEventListener('click', () => {
    if (muted) {
        bgm.muted = false;
        muted = false;
        soundToggle.innerText = 'ğŸ”Š';
    }
}, { once: true });

soundToggle.addEventListener('click', (e) => {
    e.stopPropagation();
    muted = !muted;
    bgm.muted = muted;
    soundToggle.innerText = muted ? 'ğŸ”‡' : 'ğŸ”Š';
});

/* ================= ğŸŒ± ä½ åŸæœ¬çš„é€»è¾‘ï¼šå®Œæ•´ä¿ç•™ ================= */

const config = {
    joy: { animal: 'ğŸ¶' },
    anger: { animal: 'ğŸ¦' },
    sadness: { animal: 'ğŸ°' },
    peace: { animal: 'ğŸ±' },
    mixed: { animal: 'ğŸ»' }
};

function showPage(pageId) {
    document.querySelectorAll('[id^="page-"]').forEach(p => p.classList.add('hidden'));
    document.getElementById(`page-${pageId}`).classList.remove('hidden');
}

function analyzeEmotion(text) {
    if (/(å¼€å¿ƒ|å¿«ä¹|æ£’|å“ˆå“ˆ|è°¢)/.test(text)) return "joy";
    if (/(æ°”|æ€’|ä¸å…¬|è®¨åŒ|å§”å±ˆ)/.test(text)) return "anger";
    if (/(éš¾è¿‡|ç´¯|å“­|ç–²æƒ«|å¿ƒç¢)/.test(text)) return "sadness";
    if (/(å¹³æ·¡|è®°å½•|èŒ¶|äº‘|ç®€å•|å¹³å¸¸)/.test(text)) return "peace";
    return "mixed";
}

function getAIResponse(emotion) {
    const bank = {
        joy: "è¿™ä»½äº®äº®çš„å¿ƒæƒ…çœŸå¥½ï¼Œæˆ‘ä¼šåœ¨è¿™é‡Œå¸®ä½ ä¸€ç›´ä¿å­˜è¿™ä»½å…‰äº®ã€‚",
        anger: "æˆ‘å¬åˆ°äº†ã€‚è¿™ç§è¢«å†’çŠ¯çš„æ„Ÿè§‰ç¡®å®å¾ˆç³Ÿç³•ã€‚æˆ‘ä¼šåœ¨è¿™é‡Œé™ªä½ å®ˆç€ä½ çš„è¾¹ç•Œã€‚",
        sadness: "æƒ³å“­æˆ–è€…æƒ³æ²‰é»˜éƒ½æ²¡å…³ç³»ã€‚æˆ‘å°±åœ¨è¿™é‡Œï¼Œé™é™åœ°é™ªä½ å¾…ä¸€ä¼šå„¿ã€‚",
        peace: "å—¯ï¼Œæˆ‘åœ¨å¬ã€‚è¿™æ ·å¹³é™çš„æ—¶åˆ»ä¹Ÿå¾ˆæœ‰åŠ›é‡ã€‚",
        mixed: "æ²¡å…³ç³»ï¼Œå°±æŠŠè¿™äº›å¤æ‚çš„æ€ç»ªéƒ½æ”¾è¿›æ ‘æ´é‡Œã€‚æˆ‘ä¼šå¸®ä½ åˆ†æ‹…ã€‚"
    };
    return bank[emotion];
}

function handleRecord() {
    const text = document.getElementById('record-text').value.trim();
    const onlyRecord = document.getElementById('only-record').checked;
    if (!text) return;

    const emotion = analyzeEmotion(text);
    const response = onlyRecord ? "" : getAIResponse(emotion);

    const history = JSON.parse(localStorage.getItem('tree_hollow_data') || '[]');
    history.unshift({
        content: text,
        date: new Date().toLocaleString('zh-CN', {
            month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit'
        }),
        emotion,
        response
    });
    localStorage.setItem('tree_hollow_data', JSON.stringify(history));

    document.getElementById('record-text').value = '';

    if (onlyRecord) {
        showPage('home');
    } else {
        document.getElementById('animal-container').innerText = config[emotion].animal;
        document.getElementById('ai-response').innerText = response;
        showPage('feedback');
    }
}

function showHistory() {
    const history = JSON.parse(localStorage.getItem('tree_hollow_data') || '[]');
    const list = document.getElementById('history-list');

    list.innerHTML = history.length === 0
        ? `<p class="text-center text-stone-300 italic py-10">è¿™é‡Œè¿˜æ˜¯ç©ºçš„ã€‚</p>`
        : history.map(item => `
            <div class="border-l-2 border-stone-200 pl-4 py-1">
                <div class="flex items-center gap-2 mb-1">
                    <span class="text-lg">${config[item.emotion].animal}</span>
                    <span class="text-[10px] text-stone-300">${item.date}</span>
                </div>
                <p class="text-stone-600 text-sm mb-2">${item.content}</p>
                ${item.response ? `<div class="text-[12px] text-stone-400 italic bg-stone-50 p-2 rounded">æ ‘æ´ï¼š${item.response}</div>` : ''}
            </div>
        `).join('');

    showPage('history');
}
</script>

</body>
</html>
